
menuconfig PKG_USING_CMBACKTRACE
    bool "CmBacktrace: Advanced fault backtrace library for ARM Cortex-M series MCU."
    default n

if PKG_USING_CMBACKTRACE

    config CMBACKTRACE_FIRMWARE_NAME
        string "Firmware name for CmBacktrace log identification"
        default "rt-thread"

    config CMBACKTRACE_HARDWARE_VER
        string "Hardware version for CmBacktrace log identification"
        default "1.0"

    config CMBACKTRACE_SOFTWARE_VER
        string "Software version for CmBacktrace log identification"
        default "1.0"

    choice
        prompt "CPU Platform"
        default PKG_CMBACKTRACE_PLATFORM_M0_M0PLUS if ARCH_ARM_CORTEX_M0
        default PKG_CMBACKTRACE_PLATFORM_M3 if ARCH_ARM_CORTEX_M3
        default PKG_CMBACKTRACE_PLATFORM_M4 if ARCH_ARM_CORTEX_M4
        default PKG_CMBACKTRACE_PLATFORM_M7 if ARCH_ARM_CORTEX_M7
        default PKG_CMBACKTRACE_PLATFORM_M33 if ARCH_ARM_CORTEX_M33
        default PKG_CMBACKTRACE_PLATFORM_NOT_SELECTED
        help
          Select the ARM Cortex-M CPU Platform of your device
        config PKG_CMBACKTRACE_PLATFORM_M0_M0PLUS
            bool "Cortex-M0/M0+"
        config PKG_CMBACKTRACE_PLATFORM_M3
            bool "Cortex-M3"
        config PKG_CMBACKTRACE_PLATFORM_M4
            bool "Cortex-M4"
        config PKG_CMBACKTRACE_PLATFORM_M7
            bool "Cortex-M7"
        config PKG_CMBACKTRACE_PLATFORM_M33
            bool "Cortex-M33"
        config PKG_CMBACKTRACE_PLATFORM_NOT_SELECTED
            bool "Not selected, please select"
    endchoice

    config PKG_CMBACKTRACE_DUMP_STACK
        bool
        prompt "Dump the thread or main stack info"
        default y
        help
          Dump the stack information when a fault occurs. It will add a lot of print information.

    choice
        prompt "Language of print information"
        default PKG_CMBACKTRACE_PRINT_ENGLISH
        help
          Select the language of print information when a fault occurs
        config PKG_CMBACKTRACE_PRINT_ENGLISH
            bool "Engish"
        config PKG_CMBACKTRACE_PRINT_CHINESE
            bool "Chinese (zh_CN.GB18030)"
        if PKG_CMBACKTRACE_VER_NUM > 0x10400
            config PKG_CMBACKTRACE_PRINT_CHINESE_UTF8
                bool "Chinese (zh_CN.UTF-8)"
        endif
    endchoice

    if PKG_CMBACKTRACE_VER_NUM > 0x10300
        config CMB_USING_FAL_FLASH_LOG
            bool
            prompt "Save the log to FAL flash partition"
            default n
            select PKG_USING_FAL if RT_VER_NUM < 0x40100
            select RT_USING_FAL if RT_VER_NUM >= 0x40100
            help
              The log will save to the FAL flash partition when case hardfault and assert.

        config CMB_USING_FAL_BACKUP_LOG_TO_FILE
            bool
            prompt "Backup the flash log to file when next reboot"
            default y
            depends on CMB_USING_FAL_FLASH_LOG
            select RT_USING_DFS      if RT_VER_NUM < 0x40100

        config CMB_FAL_FLASH_LOG_PART
            string "The flash partition name for saving log"
            default "cmb_log"
            depends on CMB_USING_FAL_FLASH_LOG
            help
                The patition name is defined in FAL partiton table. Please make sure it has enough space.

        config CMB_FLASH_LOG_PART_WG
            int "Flash log partition write granularity (in bytes)"
            default 8
            help
                Specifies the write granularity of the flash memory used for the log partition.
                This value must be a power of 2 (e.g., 1, 2, 4, 8, 16) and should match the
                'write_gran' property of your flash device in the FAL configuration.
                Check your MCU's datasheet or BSP's FAL setup for the correct value.

        config CMB_LOG_FILE_PATH
            string "The backup log file's path"
            default "/log/cmb.log"
            depends on CMB_USING_FAL_BACKUP_LOG_TO_FILE
    endif

    config PKG_CMBACKTRACE_ENABLE_TEST
    bool "Enable MSH test commands for CmBacktrace"
    default n
    help
        If you select this option, MSH commands like 'cmb_test' will be
        compiled. This allows you to trigger faults (e.g., division by
        zero, unaligned access) from the console to test the backtrace
        functionality.
        Disable this for release versions to save code size.

    config PKG_CMBACKTRACE_PATH
        string
        default "/packages/tools/CmBacktrace"

    choice
        prompt "Version"
        default PKG_USING_CMBACKTRACE_V10401
        help
            Select the this package version

        config PKG_USING_CMBACKTRACE_V10401
            bool "v1.4.1"

        config PKG_USING_CMBACKTRACE_V10400
            bool "v1.4.0"

        config PKG_USING_CMBACKTRACE_V10300
            bool "v1.3.0"

        config PKG_USING_CMBACKTRACE_V10202
            bool "v1.2.2"

        config PKG_USING_CMBACKTRACE_V10200
            bool "v1.2.0"

        config PKG_USING_CMBACKTRACE_LATEST_VERSION
            bool "latest"
    endchoice

    config PKG_CMBACKTRACE_VER
        string
        default "v1.4.1" if PKG_USING_CMBACKTRACE_V10401
        default "v1.4.0" if PKG_USING_CMBACKTRACE_V10400
        default "v1.3.0" if PKG_USING_CMBACKTRACE_V10300
        default "v1.2.2" if PKG_USING_CMBACKTRACE_V10202
        default "v1.2.0" if PKG_USING_CMBACKTRACE_V10200
        default "latest" if PKG_USING_CMBACKTRACE_LATEST_VERSION

    config PKG_CMBACKTRACE_VER_NUM
        hex
        default 0x10401    if PKG_USING_CMBACKTRACE_V10401
        default 0x10400    if PKG_USING_CMBACKTRACE_V10400
        default 0x10300    if PKG_USING_CMBACKTRACE_V10300
        default 0x10202    if PKG_USING_CMBACKTRACE_V10202
        default 0x10200    if PKG_USING_CMBACKTRACE_V10200
        default 0x99999    if PKG_USING_CMBACKTRACE_LATEST_VERSION

endif
